{{ define "title"}}<title>登录 - {{.siteName}}</title>{{ end }}


{{define "content"}}
<div class="mt-4 dark:text-white">
    <form action="/u/login" method="post" autocomplete="off">
        <p class="font-bold text-5 mb-4">登录</p>
        {{if .ClientID }}
        <div id="g_id_onload"
            data-client_id="{{.ClientID}}"
            data-context="signin"
            data-invite_code="{{.code}}"
            data-login_uri="{{.SiteUrl}}/oauth/callback/google"
            data-auto_prompt="false">
        </div>
        <div class="g_id_signin"
                     data-type="standard"
                     data-shape="rectangular"
                     data-theme="outline"
                     data-text="signin_with"
                     data-size="medium"
                     data-logo_alignment="left"
                style="max-width:200px">
                </div>
                <script src="https://accounts.google.com/gsi/client" async></script>
        <br>
        <p class="text-4 mb-4">—— OR ——</p>
        {{end}}
        <div class="flex flex-col gap-2">
            <div class="flex flex-row items-center">
                <div class="mr-2 text-sm">用户</div>
                <div>
                    <input name="username"
                           type="text"
                           class="input"
                           placeholder="用户名或邮箱"
                           autocomplete="off"
                           value=""
                    />
                </div>
            </div>
            <div class="flex flex-row items-center">
                <div class="mr-2 text-sm">密码</div>
                <div>
                    <input type="password" name="password" class="input" value="" autocomplete="off"/>
                </div>
            </div>
            <div class="flex flex-row items-center">
                <div class="mr-2 text-sm">验证码</div>
                <div class="flex items-center gap-2">
                    <input type="number"
                           name="captcha_answer"
                           class="input w-24"
                           placeholder="点击获取"
                           onclick="getCaptcha()"
                           id="captchaAnswer"
                           readonly>
                    <span id="captcha-question" class="text-sm font-medium"></span>
                      <input type="hidden" name="captcha_id" id="captchaId">
                </div>
            </div>
            <div class="flex flex-row gap-2 items-center">
                <button class="btn" type="submit">登录</button>
                <div class="text-red text-sm">{{.msg}}</div>
            </div>
            {{if  eq .settings.RegMode "open"}}
                <p class="text-sm text-gray">新用户 <a class="aLink underline" href="/invite/open">注册</a></p>
            {{else if eq .settings.RegMode "invite"}}
                <p class="text-sm text-gray">目前仅开放邀请注册</p>
            {{end}}
            <p class="text-sm text-gray">忘记密码?去<a class="aLink underline" href="/resetPwd">重置密码</a></p>
        </div>
    </form>
</div>
<script>
    function getCaptcha() {
        fetch('/api/captcha/generate')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('captcha-question').textContent = data.question;
                    document.getElementById('captchaId').value = data.id;
                    document.getElementById('captchaAnswer').removeAttribute('readonly');
                    document.getElementById('captchaAnswer').placeholder = '';
                    document.getElementById('captchaAnswer').value = '';
                    document.getElementById('captchaAnswer').focus();
                }
            })
            .catch(error => {
                console.error('Error generating captcha:', error);
                document.getElementById('captcha-question').textContent = '获取失败，请重试';
            });
    }
</script>
{{end}}
{{ define "afterBody"}}{{end}}